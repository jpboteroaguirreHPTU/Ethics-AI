<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hospital Aurora ‚Äî IA en la Caja Negra (Inmersivo)</title>
<meta name="description" content="Juego √©tico inmersivo sobre opacidad y explicabilidad en IA cl√≠nica.">
<style>
  :root{
    --bg1:#0a0f1e; --bg2:#0e1730; --card:#0f1b3d; --panel:#0b1430;
    --ink:#e9f0ff; --muted:#9fb0d1; --accent:#7dd3fc; --accent2:#a78bfa;
    --good:#5eead4; --warn:#fbbf24; --bad:#fb7185; --ok:#c7f9cc;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:radial-gradient(1200px 800px at 20% -10%, #14224f 0%, transparent 60%),
               radial-gradient(1000px 600px at 120% 120%, #241045 0%, transparent 60%),
               linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
    overflow:hidden;
  }
  .stars{position:fixed; inset:0; pointer-events:none; background-image:radial-gradient(#4cc9f0 1px, transparent 1px);
         background-size:3px 3px; opacity:.05; animation:twinkle 8s linear infinite;}
  @keyframes twinkle { 0%{opacity:.02} 50%{opacity:.06} 100%{opacity:.02} }
  .app{position:relative; display:flex; height:100%; width:100%;}
  .sidebar{
    width:320px; background:linear-gradient(180deg, rgba(20,26,58,.85), rgba(12,17,40,.85));
    border-right:1px solid rgba(255,255,255,.05); padding:18px; display:flex; flex-direction:column; gap:14px;
  }
  .brand{display:flex; align-items:center; gap:10px}
  .logo{width:36px; height:36px; border-radius:9px; background:conic-gradient(from 180deg at 50% 50%, #7dd3fc, #a78bfa, #34d399, #7dd3fc);
        box-shadow:0 0 20px rgba(125,211,252,.35)}
  .brand h1{font-size:1.1rem; margin:0}
  .small{font-size:.9rem; color:var(--muted)}
  .meter{background:#0b1430; border:1px solid rgba(255,255,255,.08); border-radius:12px; overflow:hidden}
  .meter .bar{height:10px; background:linear-gradient(90deg, var(--accent), var(--accent2)); width:0%}
  .stat{display:flex; justify-content:space-between; align-items:center; margin:.3rem 0; font-size:.9rem}
  .tag{border:1px solid rgba(255,255,255,.08); border-radius:999px; padding:.15rem .6rem; color:#cfe3ff; font-size:.82rem; margin-right:.4rem}
  .btn, .choice{cursor:pointer; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.02); color:var(--ink);
       border-radius:12px; padding:.75rem 1rem; font-weight:600; transition:all .15s ease; text-align:left}
  .btn:hover, .choice:hover{transform:translateY(-1px); background:rgba(125,211,252,.08); border-color:rgba(125,211,252,.25)}
  .btn:active, .choice:active{transform:translateY(0)}
  .main{flex:1; display:flex; flex-direction:column; padding:20px; gap:14px}
  .hud{display:flex; align-items:center; justify-content:space-between; gap:12px}
  .progress{flex:1; height:8px; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden}
  .progress .bar{height:8px; width:0%; background:linear-gradient(90deg, var(--accent2), var(--accent))}
  .timer{min-width:110px; text-align:center; border:1px solid rgba(255,255,255,.08); padding:.45rem .7rem; border-radius:10px}
  .timer span{font-variant-numeric:tabular-nums}
  .scene{flex:1; display:flex; gap:16px; min-height:0}
  .panel{
    flex:2; background:linear-gradient(180deg,rgba(12,18,45,.8),rgba(11,17,38,.8));
    border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:18px; overflow:auto
  }
  .panel h2{margin:.2rem 0 .6rem 0}
  .choices{display:grid; gap:10px; margin-top:10px}
  .log{
    flex:1; background:linear-gradient(180deg,rgba(10,16,35,.7),rgba(10,16,35,.5));
    border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:14px; overflow:auto
  }
  .log h3{margin:.2rem 0 .5rem 0; font-size:1rem}
  .log .entry{font-size:.92rem; color:#cfe3ff; border-left:2px solid rgba(125,211,252,.35); padding-left:.6rem; margin:.4rem 0}
  .kbd{display:inline-block; padding:.1rem .4rem; border:1px solid rgba(255,255,255,.25); border-radius:6px; font-size:.85rem; color:#d8e5ff}
  .footer{font-size:.9rem; color:var(--muted); text-align:right}
  .pulse{animation:pulse 1.5s infinite}
  @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(125,211,252,.35)}70%{box-shadow:0 0 0 12px rgba(125,211,252,0)}100%{box-shadow:0 0 0 0 rgba(125,211,252,0)}}
  @media (max-width: 1024px){ .sidebar{display:none} }
  @media (max-width: 720px){ .scene{flex-direction:column} .log{order:2} }
</style>
</head>
<body>
<div class="stars" aria-hidden="true"></div>
<div class="app" role="application" aria-label="Hospital Aurora ‚Äî IA en la Caja Negra">
  <aside class="sidebar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Hospital Aurora</h1>
        <div class="small">Simulador √©tico ‚Äî IA en la caja negra</div>
      </div>
    </div>

    <div class="stat"><span>Puntaje √©tico</span><strong id="scoreLabel">50</strong></div>
    <div class="meter" aria-label="Puntaje √©tico"><div id="scoreBar" class="bar" style="width:50%"></div></div>

    <div class="stat"><span>Confianza</span><strong id="trustLabel">50</strong></div>
    <div class="meter" aria-label="Confianza"><div id="trustBar" class="bar" style="width:50%"></div></div>

    <div class="stat"><span>Equidad</span><strong id="fairLabel">50</strong></div>
    <div class="meter" aria-label="Equidad"><div id="fairBar" class="bar" style="width:50%"></div></div>

    <button class="btn" id="toggleAudio" aria-pressed="false">üîà Sonido: off</button>
    <button class="btn" id="helpBtn">‚ùì Ayuda</button>
    <div class="small">Mejor puntaje: <span id="bestScore">‚Äî</span></div>
  </aside>

  <main class="main">
    <div class="hud">
      <div class="progress" aria-label="Progreso"><div id="progBar" class="bar" style="width:0%"></div></div>
      <div class="timer" aria-live="polite">‚è±Ô∏è <span id="timeLeft">‚Äî</span></div>
    </div>

    <div class="scene">
      <section class="panel" id="panel"></section>
      <aside class="log">
        <h3>Registro de decisiones</h3>
        <div id="log"></div>
      </aside>
    </div>

    <div class="footer">Controles: <span class="kbd">‚Üë/‚Üì</span> mover ¬∑ <span class="kbd">Enter</span> elegir ¬∑ <span class="kbd">H</span> ayuda ¬∑ <span class="kbd">S</span> sonido</div>
  </main>
</div>

<script>
// Audio SFX
const sfx = { enabled:false, ctx:null,
  beep(freq=600, dur=.08, type="sine"){
    if(!sfx.enabled) return;
    if(!sfx.ctx) sfx.ctx = new (window.AudioContext||window.webkitAudioContext)();
    const now = sfx.ctx.currentTime, o = sfx.ctx.createOscillator(), g = sfx.ctx.createGain();
    o.type=type; o.frequency.value=freq; o.connect(g); g.connect(sfx.ctx.destination);
    g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.2, now+.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now+dur); o.start(now); o.stop(now+dur);
  }
};

// Estado
const state={step:0, score:50, trust:50, fair:50, seconds:60, selected:0};
const scenes=[
  { title:"Briefing",
    html:`<h2 class="pulse">üß† Hospital Aurora ‚Äî IA en la Caja Negra</h2>
      <p>Eres parte del comit√© de implementaci√≥n de IA. Decide en <strong>4 escenarios</strong> con l√≠mite de tiempo. 
      Objetivo: <strong>maximizar puntaje √©tico, confianza y equidad</strong>.</p>
      <div class="choices"><button class="choice" data-next>Comenzar la simulaci√≥n</button></div>`,
    time:0 },
  { title:"Ronda 1 ‚Äî Optum (opacidad t√©cnica)",
    html:`<h2>Ronda 1 ‚Äî Optum (opacidad t√©cnica)</h2>
      <p>Algoritmo asigna pacientes usando <em>gasto hist√≥rico</em> como proxy. Zonas vulnerables rara vez son priorizadas.</p>`,
    choices:[
      {text:"A) Mantener el modelo: su AUC es alta", delta:{score:-12,trust:-8,fair:-15}, fb:"La AUC no refleja sesgo poblacional; sin auditor√≠a baja equidad."},
      {text:"B) Exigir variables cl√≠nicas directas", delta:{score:+10,trust:+6,fair:+8}, fb:"Mejora causalidad y reduce sesgo estructural."},
      {text:"C) Auditor√≠a externa y reentrenamiento", delta:{score:+15,trust:+10,fair:+12}, fb:"Evidencia y trazabilidad independiente."}
    ], time:55 },
  { title:"Ronda 2 ‚Äî DeepMind‚ÄìNHS (opacidad institucional)",
    html:`<h2>Ronda 2 ‚Äî DeepMind‚ÄìNHS (opacidad institucional)</h2>
      <p>Contrato confidencial; no permite auditor√≠as externas.</p>`,
    choices:[
      {text:"A) Publicar resumen t√©cnico y manual", delta:{score:+5,trust:+5,fair:+2}, fb:"Transparencia superficial sin verificaci√≥n."},
      {text:"B) Cl√°usula de auditor√≠a y trazas de decisi√≥n", delta:{score:+15,trust:+12,fair:+8}, fb:"Transparencia institucional efectiva."},
      {text:"C) Proceder por ser l√≠der del mercado", delta:{score:-10,trust:-12,fair:-10}, fb:"Marca no reemplaza rendici√≥n de cuentas."}
    ], time:50 },
  { title:"Ronda 3 ‚Äî ChatGPT cl√≠nico (opacidad cognitiva)",
    html:`<h2>Ronda 3 ‚Äî ChatGPT cl√≠nico (opacidad cognitiva)</h2>
      <p>Residente usa LLM para diagn√≥stico con explicaci√≥n convincente.</p>`,
    choices:[
      {text:"A) Confiar si suena razonable", delta:{score:-12,trust:-15,fair:-5}, fb:"Narrativa ‚â† causa. Riesgo de alucinaciones."},
      {text:"B) Verificar con datos y fuentes trazables", delta:{score:+10,trust:+10,fair:+5}, fb:"Buenas pr√°cticas de verificaci√≥n."},
      {text:"C) Usar para borradores con revisi√≥n formal", delta:{score:+10,trust:+8,fair:+4}, fb:"Supervisi√≥n humana expl√≠cita."}
    ], time:45 },
  { title:"Ronda 4 ‚Äî Escribas IA (t√©cnica + institucional)",
    html:`<h2>Ronda 4 ‚Äî Escribas IA (t√©cnica + institucional)</h2>
      <p>IA redacta notas desde audio. No hay m√©tricas p√∫blicas de fidelidad por especialidad.</p>`,
    choices:[
      {text:"A) Adoptar por ahorro de tiempo; editar si hay quejas", delta:{score:-15,trust:-10,fair:-8}, fb:"Omisiones/fabricaciones no detectadas."},
      {text:"B) Piloto: medir error por palabra, omisiones, fabricaciones", delta:{score:+15,trust:+10,fair:+10}, fb:"M√©tricas expl√≠citas de fidelidad narrativa."},
      {text:"C) Consentimiento informado y opt-out", delta:{score:+10,trust:+12,fair:+8}, fb:"Respeta autonom√≠a y alinea expectativas."}
    ], time:40 },
  { title:"Debrief", html:`<h2>Informe de misi√≥n</h2><div id="summary"></div>
    <div class="choices"><button class="choice" data-restart>Jugar de nuevo</button></div>`, time:0 }
];

const el={
  panel:document.getElementById('panel'), log:document.getElementById('log'),
  progBar:document.getElementById('progBar'), timer:document.getElementById('timeLeft'),
  scoreLabel:document.getElementById('scoreLabel'), trustLabel:document.getElementById('trustLabel'), fairLabel:document.getElementById('fairLabel'),
  scoreBar:document.getElementById('scoreBar'), trustBar:document.getElementById('trustBar'), fairBar:document.getElementById('fairBar'),
  helpBtn:document.getElementById('helpBtn'), toggleAudio:document.getElementById('toggleAudio'), bestScore:document.getElementById('bestScore')
};

function clamp(n,min,max){return Math.max(min,Math.min(max,n));}
function pct(n){return clamp(n,0,100)+"%";}
function updateHUD(){
  el.scoreLabel.textContent=state.score; el.trustLabel.textContent=state.trust; el.fairLabel.textContent=state.fair;
  el.scoreBar.style.width=pct(state.score); el.trustBar.style.width=pct(state.trust); el.fairBar.style.width=pct(state.fair);
  el.progBar.style.width=(state.step/(scenes.length-1))*100+"%";
  const best=+localStorage.getItem("aurora_best")||0; el.bestScore.textContent=best?best:"‚Äî";
}
function addLog(text){ const d=document.createElement('div'); d.className="entry"; d.textContent=text; el.log.prepend(d); }

let interval=null;
function startTimer(seconds){
  clearInterval(interval);
  if(!seconds){el.timer.textContent="‚Äî";return;}
  let t=seconds; el.timer.textContent=t+" s";
  interval=setInterval(()=>{ t--; el.timer.textContent=t+" s"; if(t===10) sfx.beep(900,.06,"square");
    if(t<=0){ clearInterval(interval); choose(0,true); } },1000);
}

function renderScene(){
  const sc=scenes[state.step];
  el.panel.innerHTML=sc.html+(sc.choices?renderChoices(sc.choices):"");
  updateHUD(); startTimer(sc.time); wire(sc.choices);
  state.selected=0; highlightChoice(state.selected);
}
function renderChoices(choices){ return `<div class="choices" role="listbox">${choices.map((c,i)=>`<button class="choice" data-index="${i}">${c.text}</button>`).join("")}</div>`; }
function wire(choices){
  el.panel.querySelectorAll("[data-next]").forEach(b=>b.addEventListener("click",()=>{state.step++; renderScene(); sfx.beep(700,.06,"sine");}));
  el.panel.querySelectorAll("[data-restart]").forEach(b=>b.addEventListener("click",()=>{reset(); sfx.beep(700,.06,"sine");}));
  el.panel.querySelectorAll(".choice[data-index]").forEach(b=>b.addEventListener("click",()=>{choose(+b.getAttribute("data-index"),false);}));
}
function choose(index,timeout){
  const sc=scenes[state.step]; if(!sc.choices) return;
  const ch=sc.choices[index]||sc.choices[0];
  state.score=clamp(state.score+(ch.delta?.score||0),0,100);
  state.trust=clamp(state.trust+(ch.delta?.trust||0),0,100);
  state.fair=clamp(state.fair+(ch.delta?.fair||0),0,100);
  addLog(`${sc.title} ‚Äî ${timeout?"‚è±Ô∏è Sin respuesta":ch.text} ‚Üí ${ch.fb}`); sfx.beep(timeout?250:520,.07,timeout?"sawtooth":"triangle");
  state.step++;
  if(state.step>=scenes.length-1){
    const best=+localStorage.getItem("aurora_best")||0; if(state.score>best) localStorage.setItem("aurora_best",state.score);
    const summary=document.createElement("div");
    summary.innerHTML = `<p><strong>Puntaje final:</strong> ${state.score} ¬∑ <strong>Confianza:</strong> ${state.trust} ¬∑ <strong>Equidad:</strong> ${state.fair}</p>
      <div class="box">${interpret()}</div>`;
    scenes[scenes.length-1].html = `<h2>Informe de misi√≥n</h2>${summary.outerHTML}<div class="choices"><button class="choice" data-restart>Jugar de nuevo</button></div>`;
  }
  renderScene();
}
function interpret(){ const s=state.score,t=state.trust,f=state.fair;
  if(s>=80&&t>=70&&f>=70) return "Excelente: promoviste transparencia institucional, verificaci√≥n cl√≠nica y m√©tricas de fidelidad por especialidad.";
  if(s>=60) return "Bien: identificaste riesgos y aplicaste salvaguardas; refuerza medici√≥n de equidad y comunicaci√≥n con pacientes.";
  if(s>=40) return "Intermedio: confiaste en rendimiento sin evidencia suficiente; implementa pilotos con auditor√≠a y consentimiento.";
  return "Riesgoso: delegaste decisiones a cajas negras; urge auditor√≠a externa, trazas de decisi√≥n y m√©tricas por servicio.";
}
function reset(){ state.step=0; state.score=50; state.trust=50; state.fair=50; el.log.innerHTML=""; renderScene(); }

// Key controls & toggles
document.addEventListener("keydown",e=>{
  const btns=Array.from(document.querySelectorAll(".choice[data-index]"));
  if(e.key==="ArrowDown"){ state.selected=Math.min(btns.length-1,state.selected+1); highlightChoice(state.selected); e.preventDefault(); }
  if(e.key==="ArrowUp"){ state.selected=Math.max(0,state.selected-1); highlightChoice(state.selected); e.preventDefault(); }
  if(e.key==="Enter"&&btns[state.selected]){ btns[state.selected].click(); e.preventDefault(); }
  if(e.key.toLowerCase()==="h"){ alert("Objetivo: maximizar Puntaje, Confianza y Equidad.
‚Ä¢ Prefiere trazabilidad y auditor√≠a.
‚Ä¢ Evita proxies sesgados.
‚Ä¢ Verifica LLM con datos/fuentes.
‚Ä¢ Mide fidelidad de escribas.
Controles: ‚Üë/‚Üì mover ¬∑ Enter elegir ¬∑ S sonido ¬∑ H ayuda"); }
  if(e.key.toLowerCase()==="s"){ toggleAudio(); }
});
function highlightChoice(i){ document.querySelectorAll(".choice[data-index]").forEach((b,idx)=>{ b.style.outline=(idx===i?"2px solid var(--accent)":"none"); }); }
document.getElementById("helpBtn").addEventListener("click",()=>alert("Consejos y controles:
‚Üë/‚Üì mover ¬∑ Enter elegir ¬∑ S sonido ¬∑ H ayuda"));
function toggleAudio(){ sfx.enabled=!sfx.enabled; const t=document.getElementById("toggleAudio"); t.textContent=sfx.enabled?"üîä Sonido: on":"üîà Sonido: off"; t.setAttribute("aria-pressed", sfx.enabled?"true":"false"); if(sfx.enabled) sfx.beep(800,.08,"sine"); }
document.getElementById("toggleAudio").addEventListener("click",toggleAudio);

// Init
reset();
</script>
</body>
</html>
